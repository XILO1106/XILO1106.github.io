<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XILO的博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
    <script src="./tailwind.config.js"></script>
    <link rel="stylesheet" href="./tailwind-utilities.css">
</head>
<body class="font-inter font-inter bg-gray-50 text-dark antialiased flex flex-col min-h-screen">
<!-- 页头 -->
<div id="header-placeholder"></div>

<!-- 搜索和筛选区 - 直接放在导航栏下方，减少空白 -->
<section class="pt-20 pb-8 bg-white border-b border-gray-100">
    <div class="container mx-auto px-4 md:px-6">
        <div class="flex flex-col md:flex-row gap-6">
            <!-- 搜索框 -->
            <div class="relative flex-grow max-w-2xl">
                <input
                        type="text"
                        id="search-input"
                        placeholder="搜索文章..."
                        class="w-full pl-4 pr-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                >
            </div>

            <!-- 分类筛选 -->
            <div class="flex flex-wrap gap-2 items-center" id="categories-container">
                <span class="text-muted whitespace-nowrap hidden sm:inline">分类:</span>
                <!-- 分类按钮将在这里自动生成 -->
            </div>
        </div>

        <!-- 结果统计 -->
        <div class="flex justify-between items-start sm:items-center mt-6">
            <p class="text-muted" id="result-count">找到 <span class="font-medium text-dark">9</span> 篇文章</p>
        </div>
    </div>
</section>

<!-- 文章列表 - 恢复网格布局 -->
<section class="py-12 bg-white flex-grow">
    <div class="container mx-auto px-4 md:px-6">
        <!-- 恢复响应式网格布局 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="articles-container">
            <!-- 文章将通过JavaScript从字典加载 -->
        </div>

        <!-- 分页导航 -->
        <div class="flex justify-center mt-16" id="pagination-container">
            <nav class="inline-flex rounded-md shadow-sm -space-x-px" aria-label="分页">
                <button class="page-btn relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                        id="first-page">
                    <span class="fa fa-step-backward"></span>
                </button>
                <button class="page-btn relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                        id="prev-page">
                    <span class="fa fa-chevron-left"></span>
                </button>
                <button class="page-btn relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 page-active"
                        data-page="1">1
                </button>
                <button class="page-btn relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
                        data-page="2">2
                </button>
                <button class="page-btn relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                        id="next-page">
                    <span class="fa fa-chevron-right"></span>
                </button>
                <button class="page-btn relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                        id="last-page">
                    <span class="fa fa-step-forward"></span>
                </button>
            </nav>
        </div>
    </div>
</section>


<!-- 页脚 -->
<div id="footer-placeholder"></div>

<script type="module">
    import {Utils} from './utils.js';

    document.addEventListener('DOMContentLoaded', async function () {
        try {
            const config = await Utils.loadConfig();
            await Utils.loadArticles();
            console.log('文章加载完成:', Utils.getArticles());
            initPage(Utils.getArticles());
        } catch (error) {
            console.error('页面初始化失败:', error);
        }
    });

    let currentPage = 1;
    let currentCategory = 'all';
    let currentSearchTerm = '';
    const articlesPerPage = 9;

    function initPage(articlesData) {
        const articlesContainer = document.getElementById('articles-container');
        const resultCount = document.querySelector('#result-count span');
        const categoriesContainer = document.getElementById('categories-container');
        const searchInput = document.getElementById('search-input');
        const backToTopButton = document.getElementById('back-to-top');

        categoriesContainer.innerHTML = '<span class="text-muted whitespace-nowrap hidden sm:inline">分类:</span>';
        const categories = new Set();
        articlesData.forEach(article => {
            if (article.categories && Array.isArray(article.categories)) {
                article.categories.forEach(cat => {
                    if (cat) categories.add(cat);
                });
            }
        });

        const allButton = document.createElement('button');
        allButton.className = 'filter-btn filter-active px-4 py-2 rounded-full text-sm transition-colors bg-primary text-white';
        allButton.dataset.category = 'all';
        allButton.textContent = '全部';
        categoriesContainer.appendChild(allButton);

        Array.from(categories).forEach(category => {
            const button = document.createElement('button');
            button.className = 'filter-btn px-4 py-2 rounded-full text-sm bg-gray-100 hover:bg-gray-200 transition-colors';
            button.dataset.category = category;
            button.textContent = category;
            categoriesContainer.appendChild(button);
        });

        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', function () {
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('filter-active', 'bg-primary', 'text-white');
                    btn.classList.add('bg-gray-100');
                });
                this.classList.add('filter-active', 'bg-primary', 'text-white');
                this.classList.remove('bg-gray-100');
                currentCategory = this.dataset.category;
                currentPage = 1;
                renderArticles();
                updatePagination();
            });
        });

        renderArticles();
        updatePagination();


        function renderArticles() {

            articlesContainer.innerHTML = '';

            let filteredArticles = articlesData.filter(article => {

                const categoryMatch = currentCategory === 'all' ||
                    (article.categories && article.categories.includes(currentCategory));

                const searchMatch = currentSearchTerm === '' ||
                    article.title.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    article.description.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    (article.categories && article.categories.some(cat =>
                        cat.toLowerCase().includes(currentSearchTerm.toLowerCase())
                    ));

                return categoryMatch && searchMatch;
            });

            resultCount.textContent = filteredArticles.length;

            const startIndex = (currentPage - 1) * articlesPerPage;
            const paginatedArticles = filteredArticles.slice(startIndex, startIndex + articlesPerPage);

            paginatedArticles.forEach(article => {
                articlesContainer.appendChild(Utils.createArticlesCard(article));
            });

            if (paginatedArticles.length === 0) {
                articlesContainer.innerHTML = `
                <div class="col-span-full text-center py-16">
                    <p class="text-muted text-lg">没有找到符合条件的文章</p>
                </div>
                `;
            }
        }

        function updatePagination() {
            let filteredArticles = articlesData.filter(article => {
                const categoryMatch = currentCategory === 'all' || article.category === currentCategory;
                const searchMatch = currentSearchTerm === '' ||
                    article.title.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    article.description.toLowerCase().includes(currentSearchTerm.toLowerCase()) ||
                    article.category.toLowerCase().includes(currentSearchTerm.toLowerCase());
                return categoryMatch && searchMatch;
            });

            const totalPages = Math.max(1, Math.ceil(filteredArticles.length / articlesPerPage));
            const paginationContainer = document.getElementById('pagination-container');

            paginationContainer.innerHTML = `
            <nav class="inline-flex rounded-md shadow-sm -space-x-px" aria-label="分页">
                <button class="page-btn relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" id="first-page">
                    <span class="fa fa-step-backward"></span>
                </button>
                <button class="page-btn relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" id="prev-page">
                    <span class="fa fa-chevron-left"></span>
                </button>
                <button class="page-btn relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" id="next-page">
                    <span class="fa fa-chevron-right"></span>
                </button>
                <button class="page-btn relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" id="last-page">
                    <span class="fa fa-step-forward"></span>
                </button>
            </nav>
        `;
            const navElement = paginationContainer.querySelector('nav');
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');
            const firstButton = document.getElementById('first-page');
            const lastButton = document.getElementById('last-page');

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `page-btn relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium hover:bg-gray-50 ${i === currentPage ? 'page-active bg-primary text-white' : 'text-gray-700'}`;
                pageButton.dataset.page = i;
                pageButton.textContent = i;
                navElement.insertBefore(pageButton, nextButton);
            }
            document.querySelectorAll('.page-btn[data-page]').forEach(button => {
                button.addEventListener('click', function () {
                    currentPage = parseInt(this.dataset.page);
                    renderArticles();
                    updatePagination();
                    window.scrollTo({top: 200, behavior: 'smooth'});
                });
            });

            prevButton.addEventListener('click', function () {
                if (currentPage > 1) {
                    currentPage--;
                    renderArticles();
                    updatePagination();
                    window.scrollTo({top: 200, behavior: 'smooth'});
                }
            });

            nextButton.addEventListener('click', function () {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderArticles();
                    updatePagination();
                    window.scrollTo({top: 200, behavior: 'smooth'});
                }
            });

            firstButton.addEventListener('click', function () {
                if (currentPage !== 1) {
                    currentPage = 1;
                    renderArticles();
                    updatePagination();
                    window.scrollTo({top: 200, behavior: 'smooth'});
                }
            });

            lastButton.addEventListener('click', function () {
                if (currentPage !== totalPages) {
                    currentPage = totalPages;
                    renderArticles();
                    updatePagination();
                    window.scrollTo({top: 200, behavior: 'smooth'});
                }
            });

            if (currentPage === 1) {
                firstButton.disabled = true;
                prevButton.disabled = true;
                firstButton.classList.add('opacity-50', 'cursor-not-allowed');
                prevButton.classList.add('opacity-50', 'cursor-not-allowed');
            }

            if (currentPage === totalPages) {
                lastButton.disabled = true;
                nextButton.disabled = true;
                lastButton.classList.add('opacity-50', 'cursor-not-allowed');
                nextButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        searchInput.addEventListener('input', function () {
            currentSearchTerm = this.value.trim();
            currentPage = 1;
            renderArticles();
            updatePagination();
        });

    }
</script>
</body>
</html>
